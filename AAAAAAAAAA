kubectl rollout restart deploy -n cert-manager

kubectl get validatingwebhookconfigurations.admissionregistration.k8s.io cert-manager-webhook -o yaml | grep caBundle -A5


kubectl delete validatingwebhookconfiguration cert-manager-webhook
kubectl delete mutatingwebhookconfiguration cert-manager-webhook



Error from server (InternalError): error when applying patch:
{"metadata":{"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"cert-manager.io/v1\",\"kind\":\"Certificate\",\"metadata\":{\"annotations\":{},\"labels\":{\"hbt.cmhc.schl.gc.ca/owner\":\"devops\"},\"name\":\"opentelemetry-operator-service-cert\",\"namespace\":\"monitoring\"},\"spec\":{\"dnsNames\":[\"opentelemetry-operator-webhook-service.monitoring.svc\",\"opentelemetry-operator-webhook-service.monitoring.svc.cluster.local\",\"opentelemetry-operator-webhook-service.eddv-bld.svc\",\"opentelemetry-operator-webhook-service.eddv-bld.svc.cluster.local\"],\"issuerRef\":{\"kind\":\"ClusterIssuer\",\"name\":\"selfsigned-issuer\"},\"secretName\":\"opentelemetry-operator-serving-cert\"}}\n"},"labels":{"hbt.cmhc.schl.gc.ca/owner":"devops"}}}
to:
Resource: "cert-manager.io/v1, Resource=certificates", GroupVersionKind: "cert-manager.io/v1, Kind=Certificate"
Name: "opentelemetry-operator-service-cert", Namespace: "monitoring"
for: "/azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator/kustomization-output.yaml": error when patching "/azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator/kustomization-output.yaml": Internal error occurred: failed calling webhook "webhook.cert-manager.io": failed to call webhook: Post "https://cert-manager-webhook.cert-manager.svc:443/validate?timeout=30s": tls: failed to verify certificate: x509: certificate signed by unknown authority
Error from server (InternalError): error when applying patch:
{"metadata":{"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"cert-manager.io/v1\",\"kind\":\"Certificate\",\"metadata\":{\"annotations\":{},\"labels\":{\"hbt.cmhc.schl.gc.ca/owner\":\"devops\"},\"name\":\"otel-operator-serving-cert\",\"namespace\":\"monitoring\"},\"spec\":{\"dnsNames\":[\"opentelemetry-operator-webhook-service.monitoring.svc\",\"opentelemetry-operator-webhook-service.monitoring.svc.cluster.local\",\"opentelemetry-operator-webhook-service.eddv-bld.svc\",\"opentelemetry-operator-webhook-service.eddv-bld.svc.cluster.local\"],\"issuerRef\":{\"kind\":\"Issuer\",\"name\":\"selfsigned-issuer\"},\"secretName\":\"opentelemetry-operator-serving-cert\"}}\n"},"labels":{"hbt.cmhc.schl.gc.ca/owner":"devops"}},"spec":{"issuerRef":{"kind":"Issuer"}}}
to:
Resource: "cert-manager.io/v1, Resource=certificates", GroupVersionKind: "cert-manager.io/v1, Kind=Certificate"
Name: "otel-operator-serving-cert", Namespace: "monitoring"
for: "/azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator/kustomization-output.yaml": error when patching "/azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator/kustomization-output.yaml": Internal error occurred: failed calling webhook "webhook.cert-manager.io": failed to call webhook: Post "https://cert-manager-webhook.cert-manager.svc:443/validate?timeout=30s": tls: failed to verify certificate: x509: certificate signed by unknown authority
*** Done




cluster
├── base
│   ├── cert-manager-operator
│   │   ├── issuer.yaml
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   ├── eck-elasticsearch-operator
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   ├── jaeger-operator
│   │   ├── jaeger-certificate.yaml
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   └── opentelemetry-operator
│       ├── clusterroles.yaml
│       ├── kustomization.yaml
│       ├── namespace.yaml
│       ├── opentelemetry-certificate.yaml
│       ├── otel-operator-cert-alias.yaml
│       └── serviceaccount.yaml
└── overlays
    ├── EDDV
    │   ├── cert-manager-operator
    │   │   └── kustomization.yaml
    │   └── opentelemetry-operator
    │       └── kustomization.yaml
    └── EDIT
        ├── cert-manager-operator
        │   └── kustomization.yaml
        ├── eck-elasticsearch-operator
        │   └── kustomization.yaml
        ├── jaeger-operator
        │   ├── jaeger-certificate.yaml
        │   ├── jaeger-mutating-webhook-patch.yaml
        │   ├── jaeger-validating-webhook-patch.yaml
        │   └── kustomization.yaml
        └── opentelemetry-operator
            ├── clusterrolebinding.yaml
            ├── crd-patch.yaml
            ├── kustomization.yaml
            ├── opentelemetry-certificate.yaml
            ├── opentelemetry-validating-webhook-patch.yaml
            ├── opentelemetry-webhook-patch.yaml
            ├── otel-mutating-webhook-patch.yaml
            ├── otel-operator-cert-alias.yaml
            └── otel-validating-webhook-patch.yaml
helm
├── README.md
├── source
│   ├── cert-manager
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── crd-prometheus
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── elasticsearch
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── grafana
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── jaeger
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── otel-operator
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   └── prometheus
│       ├── Chart.yaml
│       └── source.yaml
└── values
    └── EDIT
        ├── cert-manager-operator
        │   ├── Chart.yaml
        │   ├── deploy.yaml
        │   └── values.yaml
        └── opentelemetry-operator
            ├── Chart.yaml
            ├── deploy.yaml
            └── values.yaml
kustomize
├── base
│   ├── elasticsearch
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── grafana
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── jaeger
│   │   ├── certificate-multisan.yaml
│   │   ├── helm-values.yaml
│   │   ├── issuer.yaml
│   │   ├── jaeger.yaml
│   │   └── kustomization.yaml
│   ├── loki
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── opentelemetry
│   │   ├── certificate-multisan.yaml
│   │   ├── collector.yaml
│   │   ├── issuer.yaml
│   │   ├── kustomization.yaml
│   │   └── serviceMetric.yaml
│   └── prometheus
│       ├── helm-values.yaml
│       └── kustomization.yaml
└── overlays
    ├── EDDV
    │   ├── crd
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── grafana
    │   │   ├── config-patch.yaml
    │   │   ├── kustomization.yaml
    │   │   └── serviceaccount.yaml
    │   ├── jaeger
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── loki
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── opentelemetry
    │   │   ├── collector-patch.yaml
    │   │   ├── kustomization.yaml
    │   │   ├── otel-collector-crd.yaml
    │   │   └── serviceMonitor.yaml
    │   └── prometheus
    │       └── kustomization.yaml
    └── EDIT
        ├── 01crd
        │   ├── helm-values.yaml
        │   └── kustomization.yaml
        ├── 02prometheus
        │   └── kustomization.yaml
        ├── 03elasticsearch
        │   └── kustomization.yaml
        ├── 03loki
        │   └── kustomization.yaml
        ├── 04jaeger
        │   ├── certificate-multisan.yaml
        │   ├── issuer.yaml
        │   ├── jaeger-webhook-patch.yaml
        │   ├── kustomization.yaml
        │   └── namespace.yaml
        ├── 05opentelemetry
        │   ├── certifcate-multisan.yaml
        │   ├── collector-patch.yaml
        │   ├── issuer.yaml
        │   ├── kustomization.yaml
        │   ├── opentelemetry-webhook-patch.yaml
        │   └── serviceMonitor.yaml
        └── 06grafana
            ├── config-patch.yaml
            ├── kustomization.yaml
            └── serviceaccount.yaml





# OpenTelemetry Operator webhooks
  - path: opentelemetry-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: opentelemetry-operator-mutation
  - path: opentelemetry-validating-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: opentelemetry-operator-validation

  # otel-operator legacy webhooks
  - path: otel-mutating-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: otel-operator-mutation
  - path: otel-validating-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: otel-operator-validation




namespace: monitoring

resources:
  - ../../../base/opentelemetry-operator
  - clusterrolebinding.yaml

patches:
  # Patch OpenTelemetry Certificate
  - path: opentelemetry-certificate.yaml
    target:
      kind: Certificate
      name: opentelemetry-operator-service-cert

  # Patch webhooks with CA injection
  - path: opentelemetry-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: opentelemetry-operator-mutation

  - path: opentelemetry-validating-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: opentelemetry-operator-validation

  # If you need the CRD patches too
  - path: crd-patch.yaml
    target:
      kind: CustomResourceDefinition



apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: otel-operator-serving-cert
  namespace: monitoring
spec:
  secretName: opentelemetry-operator-serving-cert   # reuse existing secret
  issuerRef:
    kind: Issuer
    name: selfsigned-issuer





namespace: monitoring

resources:
  - ../../../base/opentelemetry-operator
  - clusterrolebinding.yaml

patches:
  # Patch OpenTelemetry Certificate
  - path: opentelemetry-certificate.yaml
    target:
      kind: Certificate
      name: opentelemetry-operator-service-cert

  # Patch legacy alias for otel-operator
  - path: otel-operator-cert-alias.yaml
    target:
      kind: Certificate
      name: otel-operator-serving-cert

  # Patch webhooks with CA injection
  - path: opentelemetry-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: opentelemetry-operator-mutation

  - path: opentelemetry-validating-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: opentelemetry-operator-validation

  # If you need CRD patches
  - path: crd-patch.yaml
    target:
      kind: CustomResourceDefinition














cluster
├── base
│   ├── cert-manager-operator
│   │   ├── issuer.yaml
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   ├── eck-elasticsearch-operator
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   ├── jaeger-operator
│   │   ├── jaeger-certificate.yaml
│   │   ├── kustomization.yaml
│   │   └── namespace.yaml
│   └── opentelemetry-operator
│       ├── clusterroles.yaml
│       ├── kustomization.yaml
│       ├── namespace.yaml
│       ├── opentelemetry-certificate.yaml
│       └── serviceaccount.yaml
└── overlays
    ├── EDDV
    │   ├── cert-manager-operator
    │   │   └── kustomization.yaml
    │   └── opentelemetry-operator
    │       └── kustomization.yaml
    └── EDIT
        ├── cert-manager-operator
        │   └── kustomization.yaml
        ├── eck-elasticsearch-operator
        │   └── kustomization.yaml
        ├── jaeger-operator
        │   ├── jaeger-certificate.yaml
        │   ├── jaeger-mutating-webhook-patch.yaml
        │   ├── jaeger-validating-webhook-patch.yaml
        │   └── kustomization.yaml
        └── opentelemetry-operator
            ├── clusterrolebinding.yaml
            ├── crd-patch.yaml
            ├── kustomization.yaml
            ├── opentelemetry-certificate.yaml
            ├── opentelemetry-validating-webhook-patch.yaml
            ├── opentelemetry-webhook-patch.yaml
            ├── otel-mutating-webhook-patch.yaml
            ├── otel-operator-cert-alias.yaml
            └── otel-validating-webhook-patch.yaml
helm
├── README.md
├── source
│   ├── cert-manager
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── crd-prometheus
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── elasticsearch
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── grafana
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── jaeger
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   ├── otel-operator
│   │   ├── Chart.yaml
│   │   └── source.yaml
│   └── prometheus
│       ├── Chart.yaml
│       └── source.yaml
└── values
    └── EDIT
        ├── cert-manager-operator
        │   ├── Chart.yaml
        │   ├── deploy.yaml
        │   └── values.yaml
        └── opentelemetry-operator
            ├── Chart.yaml
            ├── deploy.yaml
            └── values.yaml
kustomize
├── base
│   ├── elasticsearch
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── grafana
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── jaeger
│   │   ├── certificate-multisan.yaml
│   │   ├── helm-values.yaml
│   │   ├── issuer.yaml
│   │   ├── jaeger.yaml
│   │   └── kustomization.yaml
│   ├── loki
│   │   ├── helm-values.yaml
│   │   └── kustomization.yaml
│   ├── opentelemetry
│   │   ├── certificate-multisan.yaml
│   │   ├── collector.yaml
│   │   ├── issuer.yaml
│   │   ├── kustomization.yaml
│   │   └── serviceMetric.yaml
│   └── prometheus
│       ├── helm-values.yaml
│       └── kustomization.yaml
└── overlays
    ├── EDDV
    │   ├── crd
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── grafana
    │   │   ├── config-patch.yaml
    │   │   ├── kustomization.yaml
    │   │   └── serviceaccount.yaml
    │   ├── jaeger
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── loki
    │   │   ├── helm-values.yaml
    │   │   └── kustomization.yaml
    │   ├── opentelemetry
    │   │   ├── collector-patch.yaml
    │   │   ├── kustomization.yaml
    │   │   ├── otel-collector-crd.yaml
    │   │   └── serviceMonitor.yaml
    │   └── prometheus
    │       └── kustomization.yaml
    └── EDIT
        ├── 01crd
        │   ├── helm-values.yaml
        │   └── kustomization.yaml
        ├── 02prometheus
        │   └── kustomization.yaml
        ├── 03elasticsearch
        │   └── kustomization.yaml
        ├── 03loki
        │   └── kustomization.yaml
        ├── 04jaeger
        │   ├── certificate-multisan.yaml
        │   ├── issuer.yaml
        │   ├── jaeger-webhook-patch.yaml
        │   ├── kustomization.yaml
        │   └── namespace.yaml
        ├── 05opentelemetry
        │   ├── certifcate-multisan.yaml
        │   ├── collector-patch.yaml
        │   ├── issuer.yaml
        │   ├── kustomization.yaml
        │   ├── opentelemetry-webhook-patch.yaml
        │   └── serviceMonitor.yaml
        └── 06grafana
            ├── config-patch.yaml
            ├── kustomization.yaml
            └── serviceaccount.yaml







error: namespace transformation produces ID conflict: [{"apiVersion":"cert-manager.io/v1","kind":"Certificate","metadata":{"annotations":{"internal.config.kubernetes.io/previousKinds":"Certificate","internal.config.kubernetes.io/previousNames":"jaeger-operator-service-cert","internal.config.kubernetes.io/previousNamespaces":"monitoring"},"labels":{"hbt.cmhc.schl.gc.ca/owner":"devops"},"name":"jaeger-operator-service-cert","namespace":"monitoring"},"spec":{"dnsNames":["jaeger-operator-webhook-service.monitoring.svc","jaeger-operator-webhook-service.monitoring.svc.cluster.local","jaeger-operator-webhook-service.eddv-bld.svc","jaeger-operator-webhook-service.eddv-bld.svc.cluster.local"],"issuerRef":{"kind":"ClusterIssuer","name":"selfsigned-issuer"},"secretName":"jaeger-operator-webhook-cert"}} {"apiVersion":"cert-manager.io/v1","kind":"Certificate","metadata":{"annotations":{"internal.config.kubernetes.io/previousKinds":"Certificate","internal.config.kubernetes.io/previousNames":"jaeger-operator-service-cert","internal.config.kubernetes.io/previousNamespaces":"eddv-bld"},"labels":{"hbt.cmhc.schl.gc.ca/owner":"devops"},"name":"jaeger-operator-service-cert","namespace":"monitoring"},"spec":{"dnsNames":["jaeger-operator-webhook-service.eddv-bld.svc","jaeger-operator-webhook-service.eddv-bld.svc.cluster.local"],"issuerRef":{"kind":"Issuer","name":"selfsigned-issuer"},"secretName":"jaeger-operator-service-cert","subject":{"organizationalUnits":["jaeger-operator"]}}}]
DONE resource /azp/agent/_work/5/s/cluster/overlays/EDIT/jaeger-operator
Current resource: /azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator
Set the helmGlobals.configHome to the appropriate value.
About to run kubectl kustomize
error: no resource matches strategic merge patch "MutatingWebhookConfiguration.v1.admissionregistration.k8s.io/otel-operator-mutation.[noNs]": no matches for Id MutatingWebhookConfiguration.v1.admissionregistration.k8s.io/otel-operator-mutation.[noNs]; failed to find unique target for patch MutatingWebhookConfiguration.v1.admissionregistration.k8s.io/otel-operator-mutation.[noNs]
DONE resource /azp/agent/_work/5/s/cluster/overlays/EDIT/opentelemetry-operator




cluster/base/jaeger-operator/kustomization.yaml
resources:
  - namespace.yaml
  - jaeger-certificate.yaml




cluster/base/opentelemetry-operator/opentelemetry-certificate.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: opentelemetry-operator-service-cert
  namespace: monitoring
spec:
  secretName: opentelemetry-operator-serving-cert
  issuerRef:
    name: selfsigned-issuer
    kind: ClusterIssuer     # <-- same central issuer
  dnsNames:
    - opentelemetry-operator-webhook-service.monitoring.svc
    - opentelemetry-operator-webhook-service.monitoring.svc.cluster.local
    - opentelemetry-operator-webhook-service.eddv-bld.svc
    - opentelemetry-operator-webhook-service.eddv-bld.svc.cluster.local


cluster/base/opentelemetry-operator/kustomization.yaml
resources:
  - namespace.yaml
  - serviceaccount.yaml
  - clusterroles.yaml
  - opentelemetry-certificate.yaml


resources:
  - ../../../base/jaeger-operator
patches:
  - path: jaeger-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: jaeger-operator-mutating-webhook-configuration
  - path: jaeger-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: jaeger-operator-validating-webhook-configuration



cluster/overlays/EDIT/opentelemetry-operator/kustomization.yaml
resources:
  - ../../../base/opentelemetry-operator
  - clusterrolebinding.yaml
patches:
  - path: opentelemetry-webhook-patch.yaml
    target:
      kind: MutatingWebhookConfiguration
      name: opentelemetry-operator-mutation
  - path: opentelemetry-validating-webhook-patch.yaml
    target:
      kind: ValidatingWebhookConfiguration
      name: opentelemetry-operator-validation
