error: accumulating resources: accumulation err='accumulating resources from '../../../base/loki': '/azp/agent/_work/12/s/kustomize/base/loki' must resolve to a file': recursed accumulation of path '/azp/agent/_work/12/s/kustomize/base/loki': accumulating resources: accumulation err='accumulating resources from 'namespace.yaml': evalsymlink failure on '/azp/agent/_work/12/s/kustomize/base/loki/namespace.yaml' : lstat /azp/agent/_work/12/s/kustomize/base/loki/namespace.yaml: no such file or directory': must build at directory: not a valid directory: evalsymlink failure on '/azp/agent/_work/12/s/kustomize/base/loki/namespace.yaml' : lstat /azp/agent/_work/12/s/kustomize/base/loki/namespace.yaml: no such file or directory
DONE app loki




level=info ts=2025-11-01T12:42:28.197204492Z caller=server.go:368 msg="server listening on addresses" http=[::]:3100 grpc=[::]:9095
level=info ts=2025-11-01T12:42:28.199093192Z caller=memberlist_client.go:463 msg="Using memberlist cluster label and node name" cluster_label= node=loki-write-0-1e088a6d
level=info ts=2025-11-01T12:42:28.199488192Z caller=memberlist_client.go:594 msg="memberlist fast-join starting" nodes_found=1 to_join=4
level=error ts=2025-11-01T12:42:28.29537512Z caller=resolver.go:100 msg="failed to lookup SRV records" host=_memcached-client._tcp.loki-chunks-cache.monitoring.svc err="lookup _memcached-client._tcp.loki-chunks-cache.monitoring.svc on 10.0.0.10:53: no such host"
ts=2025-11-01T12:42:28.394097648Z caller=memberlist_logger.go:74 level=warn msg="Failed to resolve loki-memberlist: lookup loki-memberlist on 10.0.0.10:53: no such host"
level=info ts=2025-11-01T12:42:28.394166948Z caller=memberlist_client.go:600 msg="fast-joining node failed" node=loki-memberlist err="1 error occurred:\n\t* Failed to resolve loki-memberlist: lookup loki-memberlist on 10.0.0.10:53: no such host\n\n"
level=warn ts=2025-11-01T12:42:28.394189648Z caller=memberlist_client.go:614 msg="memberlist fast-join finished" joined_nodes=0 elapsed_time=194.705156ms
level=info ts=2025-11-01T12:42:28.394215648Z caller=memberlist_client.go:626 phase=startup msg="joining memberlist cluster" join_members=loki-memberlist
ts=2025-11-01T12:42:28.498601377Z caller=memberlist_logger.go:74 level=warn msg="Failed to resolve loki-memberlist: lookup loki-memberlist on 10.0.0.10:53: no such host"
level=warn ts=2025-11-01T12:42:28.498638577Z caller=memberlist_client.go:660 phase=startup msg="joining memberlist cluster" attempts=1 max_attempts=10 err="1 error occurred:\n\t* Failed to resolve loki-memberlist: lookup loki-memberlist on 10.0.0.10:53: no such host\n\n"
open : no such file or directory
error creating object client
github.com/grafana/loki/v3/pkg/storage.(*LokiStore).chunkClientForPeriod

├── cluster
│   ├── base
│   │   ├── loki
│   └── overlays
├── helm
│       ├── loki
├── kustomize
│   ├── base
│   │   ├── loki
│   └── overlays
│       │   ├── loki



# values-loki-azure-mi.yaml
loki:
  auth_enabled: true

  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: azure
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: azure
    azure:
      accountName: eddv1sa
      # Workload Identity (no keys)
      useManagedIdentity: true
      useFederatedToken: true
      # Client ID of your user-assigned MI
      userAssignedId: "YOUR_UAMI_CLIENT_ID"
      # Reasonable defaults:
      requestTimeout: 60
      endpointSuffix: core.windows.net
    bucketNames:
      chunks: "chunks"
      ruler:  "ruler"
      admin:  "admin"

  # Keep chunks small & cheap to move
  ingester:
    chunk_encoding: snappy

  tracing:
    enabled: true

  querier:
    max_concurrent: 4

# Microservices with tiny floors + HPA to scale up
deploymentMode: SimpleScalable

serviceAccount:
  create: false        # we're providing it
  name: oss-sa

# Minimal resources across components
resources:
  limits: {}
  requests: {}

backend:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

read:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

write:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

# No in-cluster MinIO — we use Azure Blob
minio:
  enabled: false

# Extra runtime safety for large queries
limits_config:
  ingestion_rate_mb: 8
  ingestion_burst_size_mb: 16
  max_cache_freshness_per_query: 10m

# Ruler + compactor use the same azure buckets
ruler:
  enabled: true
  storage:
    type: azure
  rule_path: /tmp/loki/rules
  ring:
    kvstore:
      store: memberlist

compactor:
  working_directory: /data/loki/boltdb-shipper-compactor
  shared_store: azure

# Memberlist for internal discovery (keeps it simple)
memberlist:
  join_members:
    - "loki-memberlist"

# Network
ingress:
  enabled: false
