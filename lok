├── cluster
│   ├── base
│   │   ├── loki
│   └── overlays
├── helm
│       ├── loki
├── kustomize
│   ├── base
│   │   ├── loki
│   └── overlays
│       │   ├── loki



# values-loki-azure-mi.yaml
loki:
  auth_enabled: true

  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: azure
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: azure
    azure:
      accountName: eddv1sa
      # Workload Identity (no keys)
      useManagedIdentity: true
      useFederatedToken: true
      # Client ID of your user-assigned MI
      userAssignedId: "YOUR_UAMI_CLIENT_ID"
      # Reasonable defaults:
      requestTimeout: 60
      endpointSuffix: core.windows.net
    bucketNames:
      chunks: "chunks"
      ruler:  "ruler"
      admin:  "admin"

  # Keep chunks small & cheap to move
  ingester:
    chunk_encoding: snappy

  tracing:
    enabled: true

  querier:
    max_concurrent: 4

# Microservices with tiny floors + HPA to scale up
deploymentMode: SimpleScalable

serviceAccount:
  create: false        # we're providing it
  name: oss-sa

# Minimal resources across components
resources:
  limits: {}
  requests: {}

backend:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

read:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

write:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60

# No in-cluster MinIO — we use Azure Blob
minio:
  enabled: false

# Extra runtime safety for large queries
limits_config:
  ingestion_rate_mb: 8
  ingestion_burst_size_mb: 16
  max_cache_freshness_per_query: 10m

# Ruler + compactor use the same azure buckets
ruler:
  enabled: true
  storage:
    type: azure
  rule_path: /tmp/loki/rules
  ring:
    kvstore:
      store: memberlist

compactor:
  working_directory: /data/loki/boltdb-shipper-compactor
  shared_store: azure

# Memberlist for internal discovery (keeps it simple)
memberlist:
  join_members:
    - "loki-memberlist"

# Network
ingress:
  enabled: false
