@startuml testdiag
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_WITH_LEGEND()

title DEV Observability Platform â€“ C4 L2 (Container View)

Person(user, "Developer / SRE", "Uses dashboards via Azure AD SSO")

System_Boundary(obs, "Dedicated AKS Cluster") {
    Container(grafana, "Grafana", "Web UI", "Dashboards & visualization")
    Container(otel, "OTel Collector", "Go Service", "Collects & routes telemetry")
    Container(prometheus, "Prometheus", "TSDB", "Stores metrics")
    Container(loki, "Loki", "Log DB", "Stores logs")
    Container(jaeger, "Jaeger", "Tracing Backend", "Stores traces")
    Container(ingress, "NGINX Ingress", "K8s Ingress", "Routes incoming traffic")
}

System_Ext(nonprod, "Non-Prod AKS (DEV + FT)", "Kubernetes", "Telemetry sources")
System_Ext(blob, "Azure Blob Storage", "Object Storage", "Long-term retention")
System_Ext(aad, "Azure AD", "Identity Provider", "SSO authentication")

Rel(nonprod, ingress, "Send telemetry", "OTLP/gRPC")
Rel(ingress, otel, "Forward traffic")
Rel(otel, prometheus, "Send metrics")
Rel(otel, loki, "Send logs")
Rel(otel, jaeger, "Send traces")
Rel(prometheus, blob, "Export snapshots")
Rel(loki, blob, "Export logs")
Rel(user, grafana, "Access dashboards", "HTTPS")
Rel(grafana, aad, "Authenticate", "OAuth2/OIDC")

SHOW_LEGEND()
@enduml
