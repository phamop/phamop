@startuml Observability_AKS_C4_L3_Dedicated
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
LAYOUT_TOP_DOWN()

title <color:#0078D4>Observability AKS Platform â€“ Component View (L3)</color>\n<size:12>Dedicated Observability AKS Cluster managing FT & DEV telemetry</size>

' =========================
' GLOBAL STYLE
' =========================
skinparam defaultFontColor #000000
skinparam rectangleFontColor #000000
skinparam arrowFontColor #000000
skinparam noteFontColor #000000
skinparam shadowing true
skinparam arrowThickness 2
skinparam arrowColor #444444
skinparam backgroundColor #FFFFFF

' =========================
' EXTERNAL ACTORS
' =========================
Person(dev, "Developer/SRE", "Monitors both DEV & FT") #B3E5FC/Black
System_Ext(ingress, "Azure Load Balancer / Ingress", "External traffic entry point") #FFE0B2/Black
System_Ext(blob, "Azure Blob Storage", "Long-term storage") #DDDDDD/Black

' =========================
' DEV + FT CLUSTERS (Telemetry Sources)
' =========================
Container_Boundary(aks_sources, "FT & DEV AKS Clusters (Telemetry Sources)") #F1F8E9 {

  Container_Boundary(aks_dev, "AKS DEV Cluster") #E8F5E9 {
    Component(dev_apps, "DEV Applications", "Microservices, APIs") #C8E6C9
    Component(dev_kube, "Kubernetes Components", "kubelet, kube-proxy, API server") #C8E6C9
    Component(dev_nodes, "Node Metrics", "CPU, Memory, Disk, Network") #C8E6C9
    Component(dev_otel_agent, "OTel Agent", "DaemonSet collector") #A5D6A7
  }

  Container_Boundary(aks_ft, "AKS FT Cluster") #E3F2FD {
    Component(ft_apps, "FT Applications", "Test Services, Load Tests") #BBDEFB
    Component(ft_kube, "Kubernetes Components", "kubelet, kube-proxy, API server") #BBDEFB
    Component(ft_nodes, "Node Metrics", "CPU, Memory, Disk, Network") #BBDEFB
    Component(ft_otel_agent, "OTel Agent", "DaemonSet collector") #90CAF9
  }
}

' =========================
' DEDICATED OBSERVABILITY AKS CLUSTER
' =========================
Container_Boundary(obs_aks, "Dedicated Observability AKS Cluster") #FFF3E0 {

  ' ---- OTel Collector ----
  Container_Boundary(otel_collector, "OTel Collector Pod") #FFF9C4 {
    Component(otel_rcv, "Receivers", "OTLP, Prometheus, Jaeger, K8s") #FFF59D
    Component(otel_proc, "Processors", "Batch, Resource, Transform, Enrich") #FFF59D
    Component(otel_exp, "Exporters", "Prometheus, Loki, Jaeger, Azure Monitor") #FFEB3B
  }

  ' ---- Prometheus + Thanos ----
  Container_Boundary(prometheus_stack, "Prometheus + Thanos") #FBE9E7 {
    Component(prom_srv, "Prometheus Server", "Scrapes Metrics") #FFCCBC
    Component(thanos_side, "Thanos Sidecar", "Upload to Blob") #FFAB91
    Component(thanos_query, "Thanos Query", "Long-term Queries") #FF8A65
  }

  ' ---- Loki ----
  Container_Boundary(loki_stack, "Loki") #E0F7FA {
    Component(loki_dist, "Distributor", "Receives Logs") #B2EBF2
    Component(loki_ing, "Ingester", "Stores Chunks") #80DEEA
    Component(loki_q, "Querier", "Executes LogQL") #4DD0E1
  }

  ' ---- Jaeger ----
  Container_Boundary(jaeger_stack, "Jaeger") #F3E5F5 {
    Component(jaeger_col, "Collector", "Receives Spans") #E1BEE7
    Component(jaeger_ing, "Ingester", "Stores Spans") #CE93D8
    Component(jaeger_q, "Query Service", "Trace Query API") #BA68C8
  }

  ' ---- Grafana ----
  Container_Boundary(grafana_pod, "Grafana Pod") #E8EAF6 {
    Component(gf_core, "Grafana Core", "Dashboards, Alerts") #C5CAE9
    Component(gf_ds, "Data Sources", "Prometheus, Loki, Jaeger") #9FA8DA
    Component(gf_alert, "Alerting Engine", "Rules & Notifications") #7986CB
    Component(gf_auth, "OAuth2 Proxy", "Azure AD SSO") #5C6BC0
  }
}

' =========================
' TELEMETRY FLOWS
' =========================

' DEV cluster signals (green arrows)
Rel(dev_apps, dev_otel_agent, "ğŸ“ŠğŸ“œğŸ” Telemetry", "OTLP") #388E3C
Rel(dev_kube, dev_otel_agent, "ğŸ“Š API Metrics", "HTTP") #388E3C
Rel(dev_nodes, dev_otel_agent, "ğŸ“Š Node Metrics", "HTTP") #388E3C
Rel(dev_otel_agent, otel_rcv, "DEV â†’ Telemetry", "OTLP gRPC") #388E3C

' FT cluster signals (blue arrows)
Rel(ft_apps, ft_otel_agent, "ğŸ“ŠğŸ“œğŸ” Telemetry", "OTLP") #1565C0
Rel(ft_kube, ft_otel_agent, "ğŸ“Š API Metrics", "HTTP") #1565C0
Rel(ft_nodes, ft_otel_agent, "ğŸ“Š Node Metrics", "HTTP") #1565C0
Rel(ft_otel_agent, otel_rcv, "FT â†’ Telemetry", "OTLP gRPC") #1565C0

' Ingress telemetry (grey arrows)
Rel(ingress, otel_rcv, "ğŸ“œ Ingress Logs", "HTTP") #666666

' Collector â†’ processing â†’ exporters
Rel(otel_rcv, otel_proc, "Raw telemetry", "Internal") #F57F17
Rel(otel_proc, otel_exp, "Processed telemetry", "Internal") #F57F17
Rel(otel_exp, prom_srv, "ğŸ“Š Metrics", "Remote Write") #E64A19
Rel(otel_exp, loki_dist, "ğŸ“œ Logs", "HTTP Push") #00838F
Rel(otel_exp, jaeger_col, "ğŸ” Traces", "OTLP gRPC") #6A1B9A

' Backends â†’ Blob
Rel(thanos_side, blob, "ğŸ“Š Metrics Store", "HTTPS") #D84315
Rel(loki_ing, blob, "ğŸ“œ Log Chunks", "HTTPS") #006064
Rel(jaeger_ing, blob, "ğŸ” Spans", "HTTPS") #4A148C

' Grafana queries
Rel(dev, gf_auth, "Access Dashboards", "HTTPS/SSO")
Rel(gf_auth, gf_core, "Auth Tokens")
Rel(gf_core, gf_ds, "Data Queries")
Rel(gf_ds, prom_srv, "ğŸ“Š PromQL Queries")
Rel(gf_ds, thanos_query, "ğŸ“Š Historical Metrics")
Rel(gf_ds, loki_q, "ğŸ“œ LogQL Queries")
Rel(gf_ds, jaeger_q, "ğŸ” Trace Queries")
Rel(gf_core, gf_alert, "Execute Alerts")

SHOW_LEGEND()
@enduml

